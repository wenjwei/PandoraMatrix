require "Common";
require "./PandoraToolBoxSettings";
require "./PandoraToolBoxPresetFunctions";
local Logger = Common.GetLogger();

local mt = { };
function mt:New()
    local o = { };
    setmetatable(o, self);
    self.__index = self;
    return o;
end

function mt:Init(obj)
    self.transform = obj.transform
    self:InitFrame();
    self:InitMainButtonsArea();
    if PandoraToolBoxSettings.uiType == PandoraToolBoxSettings.UiType.UGUI then
        self:InitLogAreaUGUI();
        self:InitLogSearchAreaUGUI();
        self:InitFunctionAreaUGUI();
        self:InitProtocolAreaUGUI();
        self:InitCommonTipsAreaUGUI();
        PandoraToolBoxPresetFunctions.Init(self.functionArea)
        return;
    end
    if PandoraToolBoxSettings.uiType == PandoraToolBoxSettings.UiType.NGUI then
        self:InitLogAreaNGUI();
        self:InitLogSearchAreaNGUI();
        self:InitFunctionAreaNGUI();
        self:InitProtocolAreaNGUI();
        self:InitvendorAreaNGUI()
        self:InitCommonTipsAreaNGUI();
        return;
    end
end
-- region 通用
function mt:InitFrame()
    self.panelRoot = self.transform:Find("Container_root").gameObject
    self.openPanelButton = self.transform:Find("Button_openPanel").gameObject
    self.closeButton = self.transform:Find("Container_root/Container_frame/Button_close").gameObject
end

function mt:InitMainButtonsArea()
    self.logAreaButton = self.transform:Find("Container_root/Container_buttons/Button_displayLogArea").gameObject
    self.logSearchAreaButton = self.transform:Find("Container_root/Container_buttons/Button_displayLogSearchlArea").gameObject
    self.functionAreaButton = self.transform:Find("Container_root/Container_buttons/Button_displayFunctionArea").gameObject
    self.protocolAreaButton = self.transform:Find("Container_root/Container_buttons/Button_displayProtocolArea").gameObject
    if Common.GetFunctionSwitch("pandoraToolBox_NGUI") == true then
        self.vendorAreaButton = self.transform:Find("Container_root/Container_buttons/Button_displayVendorArea").gameObject
    end
end

function mt:OnDestroy()
    for key, var in pairs(self) do
        if type(var) ~= "function" then
            self[key] = nil;
        end
    end
end
-- endregion

-- region ugui panel
function mt:InitLogAreaUGUI()
    self.logArea = self.transform:Find("Container_root/Container_logArea").gameObject
    self.logLabel = self.transform:Find("Container_root/Container_logArea/Scroll View_log/Viewport/Text_log"):GetComponent("Text")
    self.clearLogButton = self.transform:Find("Container_root/Container_logArea/Button_clearLog").gameObject
    self.refreshLogButton = self.transform:Find("Container_root/Container_logArea/Button_refreshLog").gameObject
end

function mt:InitLogSearchAreaUGUI()
    self.searchLogArea = self.transform:Find("Container_root/Container_logSearchArea").gameObject
    self.searchButton = self.transform:Find("Container_root/Container_logSearchArea/Button_search").gameObject
    self.searchKeyWord = self.transform:Find("Container_root/Container_logSearchArea/InputField_searchContent"):GetComponent("InputField")

    self.searchResult = self.transform:Find("Container_root/Container_logSearchArea/Scroll View_searchedLog/Viewport/Text_searchedLog"):GetComponent("Text")
    self.searchResultGameObject = self.transform:Find("Container_root/Container_logSearchArea/Scroll View_searchedLog/Viewport/Text_searchedLog").gameObject
    self.searchResultScrollView = self.transform:Find("Container_root/Container_logSearchArea/Scroll View_searchedLog").gameObject

    self.searchResultCopyPanel = self.transform:Find("Container_root/Container_logSearchArea/InputField_searchedContentForCopy").gameObject
    self.searchResultCopyArea = self.searchResultCopyPanel:GetComponent("InputField")
end


function mt:InitFunctionAreaUGUI()
    -- 函数区
    self.functionArea = self.transform:Find("Container_root/Container_functionArea").gameObject
    self.functionGrid = self.transform:Find("Container_root/Container_functionArea/Scroll View_function/Viewport/Grid").gameObject
    self.functionButtonTemplate = self.transform:Find("Container_root/Container_functionArea/Scroll View_function/Viewport/Grid/Button_functionTemplate").gameObject
    self.functionNameInput = self.transform:Find("Container_root/Container_functionArea/Container_addFunction/InputField_buttonName"):GetComponent("InputField")
    self.functionContentInput = self.transform:Find("Container_root/Container_functionArea/Container_addFunction/InputField_functionName"):GetComponent("InputField")
    self.functionParamsInput = self.transform:Find("Container_root/Container_functionArea/Container_addFunction/InputField_functionParams"):GetComponent("InputField")
    self.defaultFunctionParamsInput = self.transform:Find("Container_root/Container_functionArea/Container_addFunction/InputField_defaultFunctionParams"):GetComponent("InputField")

    self.addFunctionButton = self.transform:Find("Container_root/Container_functionArea/Container_addFunction/Button_addNewFunction").gameObject
    self.executeFunctionButton = self.transform:Find("Container_root/Container_functionArea/Container_addFunction/Button_executeFunction").gameObject

    self.propPlaceholder = self.transform:Find("Container_root/Container_functionArea/GameObject_goodsHolder").gameObject
end




function mt:InitProtocolAreaUGUI()
    -- 协议区
    self.protocolArea = self.transform:Find("Container_root/Container_protocolArea").gameObject
    self.protocolGrid = self.transform:Find("Container_root/Container_protocolArea/Scroll View_protocol/Viewport/Grid").gameObject
    self.protocolButtonTemplate = self.transform:Find("Container_root/Container_protocolArea/Scroll View_protocol/Viewport/Grid/Button_protocolTemplate").gameObject

    self.protocolNameInput = self.transform:Find("Container_root/Container_protocolArea/Container_addProtocol/InputField_buttonName"):GetComponent("InputField")
    self.protocolContentInput = self.transform:Find("Container_root/Container_protocolArea/Container_addProtocol/InputField_protocolContent"):GetComponent("InputField")

    self.toGameToggle = self.transform:Find("Container_root/Container_protocolArea/Container_addProtocol/Container_toggles/Toggle_toGame"):GetComponent("Toggle")
    self.toPandoraToggle = self.transform:Find("Container_root/Container_protocolArea/Container_addProtocol/Container_toggles/Toggle_toPandora"):GetComponent("Toggle")

    self.addProtocolButton = self.transform:Find("Container_root/Container_protocolArea/Container_addProtocol/Button_addNewProtocol").gameObject
    self.executeProtocolButton = self.transform:Find("Container_root/Container_protocolArea/Container_addProtocol/Button_executeProtocol").gameObject
end

function mt:InitCommonTipsAreaUGUI()
    -- 通用tips
    self.commonTipsPanel = self.transform:Find("Container_root/Container_commonTips").gameObject
    self.commonTips = self.transform:Find("Container_root/Container_commonTips/Scroll View_commonTips/Viewport/Text_commonTips"):GetComponent("Text")
    self.commonTipsCloseButton = self.transform:Find("Container_root/Container_commonTips/Button_close").gameObject
end

-- endregion

-- region ngui panel
function mt:InitLogAreaNGUI()
    self.logArea = self.transform:Find("Container_root/Container_logArea").gameObject
    self.logAreaScrollView = self.transform:Find("Container_root/Container_logArea/Scroll View_log"):GetComponent("UIScrollView");
    self.logLabel = self.transform:Find("Container_root/Container_logArea/Scroll View_log/Label_log"):GetComponent("UILabel")
    -- clearLog和refreshLog按钮放置在一个新panel下，因为Scrollview有个panel，如果不放在新的panel下，会导致Label_log的层级比按钮的高，两个按钮就会点不到
    self.clearLogButton = self.transform:Find("Container_root/Container_logArea/Panel_logControlButtons/Button_clearLog").gameObject
    self.refreshLogButton = self.transform:Find("Container_root/Container_logArea/Panel_logControlButtons/Button_refreshLog").gameObject
end

function mt:InitLogSearchAreaNGUI()
    self.searchLogArea = self.transform:Find("Container_root/Container_logSearchArea").gameObject
    self.searchButton = self.transform:Find("Container_root/Container_logSearchArea/Button_search").gameObject
    self.searchKeyWord = self.transform:Find("Container_root/Container_logSearchArea/Input_searchContent"):GetComponent("UIInput")

    self.searchResult = self.transform:Find("Container_root/Container_logSearchArea/Scroll View_searchedLog/Label_searchedLog"):GetComponent("UILabel")
    self.searchResultGameObject = self.transform:Find("Container_root/Container_logSearchArea/Scroll View_searchedLog/Label_searchedLog").gameObject
    self.searchResultScrollView = self.transform:Find("Container_root/Container_logSearchArea/Scroll View_searchedLog").gameObject

    self.searchResultCopyPanel = self.transform:Find("Container_root/Container_logSearchArea/Panel_searchedLogForCopy").gameObject
    self.searchResultCopyArea = self.transform:Find("Container_root/Container_logSearchArea/Panel_searchedLogForCopy/Label_searchedLogForCopy"):GetComponent("UIInput")
end

function mt:InitFunctionAreaNGUI()
    -- 函数区
    self.functionArea = self.transform:Find("Container_root/Container_functionArea").gameObject
    self.functionGrid = self.transform:Find("Container_root/Container_functionArea/Scroll View_function/Grid").gameObject
    self.functionButtonTemplate = self.transform:Find("Container_root/Container_functionArea/Scroll View_function/Grid/Button_functionBtnTemplate").gameObject

    self.functionNameInput = self.transform:Find("Container_root/Container_functionArea/Container_addFunction/InputField_functionName"):GetComponent("UIInput")
    self.functionContentInput = self.transform:Find("Container_root/Container_functionArea/Container_addFunction/InputField_functionContent"):GetComponent("UIInput")
    self.functionParamsInput = self.transform:Find("Container_root/Container_functionArea/Container_addFunction/InputField_functionParams"):GetComponent("UIInput")
    self.defaultFunctionParamsInput = self.transform:Find("Container_root/Container_functionArea/Container_addFunction/InputField_defaultFunctionParams"):GetComponent("UIInput")

    self.addFunctionButton = self.transform:Find("Container_root/Container_functionArea/Container_addFunction/Button_addNewFunction").gameObject
    self.executeFunctionButton = self.transform:Find("Container_root/Container_functionArea/Container_addFunction/Button_executeFunction").gameObject

    self.propPlaceholder = self.transform:Find("Container_root/Container_functionArea/Container_addGoodsIcon/GameObject_goodsHolder").gameObject
end

function mt:InitProtocolAreaNGUI()
    -- 协议区
    self.protocolArea = self.transform:Find("Container_root/Container_protocolArea").gameObject
    self.protocolGrid = self.transform:Find("Container_root/Container_protocolArea/Scroll View_protocol/Grid").gameObject
    self.protocolButtonTemplate = self.transform:Find("Container_root/Container_protocolArea/Scroll View_protocol/Grid/Button_protocolBtnTemplate").gameObject

    self.protocolNameInput = self.transform:Find("Container_root/Container_protocolArea/Container_addProtocol/InputField_protocolName"):GetComponent("UIInput")
    self.protocolContentInput = self.transform:Find("Container_root/Container_protocolArea/Container_addProtocol/InputField_protocolContent"):GetComponent("UIInput")

    self.toGameToggle = self.transform:Find("Container_root/Container_protocolArea/Container_addProtocol/Container_toggles/Toggle_toGame"):GetComponent("UIToggle")
    self.toPandoraToggle = self.transform:Find("Container_root/Container_protocolArea/Container_addProtocol/Container_toggles/Toggle_toPandora"):GetComponent("UIToggle")

    self.addProtocolButton = self.transform:Find("Container_root/Container_protocolArea/Container_addProtocol/Button_addNewProtocol").gameObject
    self.executeProtocolButton = self.transform:Find("Container_root/Container_protocolArea/Container_addProtocol/Button_executeProtocol").gameObject
end

--渠道号区
function mt:InitvendorAreaNGUI()
    local pathPrefix = "Container_root/Container_vendorArea/"
    self.vendorArea = self.transform:Find("Container_root/Container_vendorArea").gameObject
    self.vendorGrid = self.transform:Find(pathPrefix.."Scroll View_activities/Grid").gameObject
    self.activityButtonTemplate = self.vendorGrid.transform:Find("Button_template").gameObject

    local containerTrans = self.transform:Find(pathPrefix.."Container_addActivity")
    local itemsParent = containerTrans:Find("Scroll View_items")
    self.activityNameInput = itemsParent:Find("Container_name/InputField_activityName"):GetComponent("UIInput")
    self.requestInput = itemsParent:Find("Container_request/Scroll View_content/InputField"):GetComponent("UIInput")
    self.whitelistInput = itemsParent:Find("Container_whitelist/Scroll View_content/InputField"):GetComponent("UIInput")
    self.blacklistInput = itemsParent:Find("Container_blacklist/Scroll View_content/InputField"):GetComponent("UIInput")
    
    self.addActivityButton = containerTrans:Find("Button_addNew").gameObject
    self.testButton = containerTrans:Find("Button_test").gameObject
end

function mt:InitCommonTipsAreaNGUI()
    -- 通用tips
    self.commonTipsPanel = self.transform:Find("Container_root/Panel_commonTips").gameObject;
    self.commonTipsScrollView = self.transform:Find("Container_root/Panel_commonTips/Scroll View_commonTips"):GetComponent("UIScrollView");
    self.commonTips = self.transform:Find("Container_root/Panel_commonTips/Scroll View_commonTips/Container_helpLocation/Label_commonTips"):GetComponent("UILabel");
    self.commonTipsCloseButton = self.transform:Find("Container_root/Panel_commonTips/Button_close").gameObject;

end

-- endregion

return mt;

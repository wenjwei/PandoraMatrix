# **DJCFrame新版本方法如下**
新版DJCFrame兼容原有版本的函数实现（可参考原有wiki），并在此基础上扩展了一些工具库。

Git地址：http://git.code.oa.com/daojuact-pandora/djcframe.git
（无权限可找haryli申请）


## 一、引用DJCFrame
```
local DJC = require("DJCFrame"):New(Configs.BASE.PANEL_NAME)

local Util      =   DJC.Util       --常用工具函数库
local Cmd       =   DJC.Cmd        --游戏常用命令封装
local UserModel =   DJC.UserModel  --用户基本信息model
local Request   =   DJC.Request    --请求接口类
local UI        =   DJC.UI         --界面相关函数
local Configs   =   DJC.DJCConfigs --全局常量配置
```

* Configs.BASE.PANEL_NAME：当前活动的面板名称，可根据实际情况自行命名，此处会根据当前活动名称创建对应的DJCFrame活动实例，多活动不会互相干扰
* DJC：当前活动的DJCFrame实例，当前实例包含如下几个工具类库：


## 二、类库介绍：

**1、Request类库介绍：**

* 初始化DJCFrame

```
Request:Init({
    BASE = {
        CHANNEL_ID            = "", -- 活动频道 channelid，必填
        ACT_STYLE             = "", -- 活动类型 actstyle，必填
        DJC_ACT_ID            = "", --道聚城活动id，必填
        AMSACT_ID             = "", --ams活动id
        INFO_ID               = "", --潘多拉活动id，必填
        SERVICE_NAME          = "", -- 业务英文名，必填
        MODULE_ID             = "", -- 上报 moduleid，现在默认为 channelid,必填
        COOKIE_NAME_PRE       = "", -- cookie 名前缀,一般为bizcode_actstyle_channelid
    }
})
```
* 请求AMS条件
```
Request:Get(
        Configs.NET.AMS_REQUEST,
        {
            alias_list = {"init"},--ams的流程别名
            needloading = "0"--请求过程共是否显示游戏loading蒙版
        },
        function(tbResp) -- 拉取成功回调
            -- 检查活动配置参数
            if func then
                func(tbResp)
            end
        end,
        function(tbResp) -- 拉取失败回调
            -- do something if you have
        end
    )
```

* 请求AMS动作
```
Request:Get(
        Configs.NET.DOAMS_REQUEST,
        {
            iFlowId = xxx--ams的流程id
        },
        function(tbResp) -- 拉取成功回调
            -- 检查活动配置参数
            if func then
                func(tbResp)
            end
        end,
        function(tbResp) -- 拉取失败回调
            -- do something if you have
        end
    )
```

* 请求道聚城海神活动道具列表+AMS条件
```
Request:Get(
        Configs.NET.INIT_REQUEST,
        {
            alias_list = {"init"},--ams的流程别名
            needloading = "0"--请求过程共是否显示游戏loading蒙版
        },
        function(tbResp) -- 拉取成功回调
            -- 检查活动配置参数
            if func then
                func(tbResp)
            end
        end,
        function(tbResp) -- 拉取失败回调
            -- do something if you have
        end
    )
```
活动信息会根据BASE配置的DJC_ACT_ID自动查询

- 请求道聚城海神活动道具列表
```
Request:Get(
        Configs.NET.DJC_REQUEST,
        {
            needCategory=1,--查询道具列表是否需要分类信息1：是，0：否
            need_limit=1,--需要返回限量信息。1，需要，0，不需要，默认0;如果需要限量，在fields字段里需要加入iActionId和sBuyLimitInfo，才能查到限量配置信息
            fields="iGoodsId,lLimitNum,lBuyNum,lTotalBuyNum,goodsLimit,goodsLeft,userFreeze",--指定要输出的【礼包信息表】字段名称，逗号隔开传入。默认查出所有字段
            page_num=1,--页码，默认1
            page_size=10--每页数量1-200，默认100
        },
        function(tbResp) -- 拉取成功回调
            -- 检查活动配置参数
            if func then
                func(tbResp)
            end
        end,
        function(tbResp) -- 拉取失败回调
            -- do something if you have
        end
    )
```
- 购买道具
```
--支付方式定义
RMB_PAY_TYPE          = "2", -- 人民币支付类型
DB_1_PAY_TYPE         = "1", -- 一级代币支付类型
DB_2_PAY_TYPE         = "3", -- 二级代币支付类型
DB_1_2_PAY_TYPE       = "4", -- 一二级代币混合支付类型
DB_3_PAY_TYPE         = "5", -- 三级代币支付类型

Request:Get(
        Configs.NET.BUY_REQUEST,
        {
            buynum = 1,--购买数量
            propid = gid,--购买的道具id
            paytype = Configs.OTHER.DB_1_PAY_TYPE--此处为点券支付，人民币支付需要在成功回调里面，调用common的Ios或安卓支付面板唤起
        },
        --道聚城购买参数
        function(tbResp) -- 拉取成功回调
            Util.PrintTb(tbResp, "==== Act Info")
        end,
        function(tbResp) -- 拉取失败回调
            Util.PrintTb(tbResp, "==== Act Info")
        end
    )
```

**2、UI类库介绍：**

- gameobject快速获取
```
UI.GO("xx/xx/xx",parent_gameobject)
```

- click事件绑定或取消
```
UI.Click(
    go,--事件对象，NGUI需要自行添加boxcollider和UIButton
    func--回调函数
)
```

- change事件绑定或取消

```
UI.Change(
    go,--事件对象
    func--回调函数
)
```

- Text/Label的Text属性赋值（兼容Ngui和Ugui）
```
UI.Text(go, value)
```

- UIInput/InputField的value属性赋值
```
UI.Val(go, value)
```

- TimeTick每一秒执行一次回调函数
```
UI.TimeTick(func)
```

- 抽奖动画跑动(函数支持多次连抽)
```
LotteryAnimate(targetNum, MaxNum, runAnimateFunc, targetFunc, endFunc)

targetNum：目标索引
MaxNum：总共多少个
runAnimateFunc：每跳动一个的执行函数
targetFunc：命中后的执行函数
endFunc：全部命中完成后执行的函数
```

**3、Util类库介绍：**

- Error日志打印
```
Util.Error(string)
```
- Log日志打印
```
Util.Log(string)
```
- Table数据日志打印：
```
Util.PrintTb(table)
```
- 经分日志上报Report：
```
Util:Report(type, reserve0, reserve1, reserve2, goodsId, goodsNum, luaRun,module)
```
- jsonencode：
```
Util.JEncode(table)
```
- jsondecode:
```
Util.JDecode(table)
```
- Split:
```
Util.Split(sStr, sDel)
```
- EncodeURI/DecodeURI:
```
Util.EncodeURI(string)
Util.DecodeURI(string)
```
- 获取cookie：
```
Util.GetCookieInfo(key)value,key
```
- 设置cookie：
```
Util.SetCookieInfo(value,key)
```
- 转换日期为时间戳：
```
--必须符合格式(%d+)-(%d+)-(%d+) (%d+):(%d+):(%d+)
Util.ConvertTimeStamp(datetimestr)
```
- InArray：
```
--table为一维数组
Util.InArray(key,table)
```
- Shuffle：打乱数组顺序
```
Util.Shuffle(table)
```

**4、Cmd类库介绍：**

- ShowLoading/CloseLoading：显示或隐藏游戏的loading蒙版
```
Cmd.ShowLoading(str)
Cmd.CloseLoading：(str)
```

- NotifyGameReady：通知游戏活动资源已经准备就绪
```
Cmd.NotifyGameReady(sPanelName)
```

- NotifyGamePanelCreated：通知游戏面板创建完成
```
Cmd.NotifyGamePanelCreated(sPanelName)
```

- NotifyGamePanelClosed：通知游戏面板已关闭
```
Cmd.NotifyGamePanelClosed(sPanelName)
```
- RefreshMoney：刷新游戏代币
```
Cmd.RefreshMoney()
```
- RefreshMail：书信游戏邮箱
```
Cmd.RefreshMail()
```

**5、UserModel类库介绍：**

- GetAppId：获取appid
```
UserModel.GetAppId()
```
- GetOpenId：获取openid
```
UserModel.GetOpenId()
```
- GetArea：获取大区id
```
UserModel.GetArea()
```
- GetPlatId：获取platid
```
UserModel.GetPlatId()
```
- GetPartition：获取partition
```
UserModel.GetPartition()
```
- GetRoleId：获取roleid
```
UserModel.GetRoleId()
```
- GetAccessToken：获取accessToken
```
UserModel.GetAccessToken()
```
- GetPayToken：获取paytoken
```
UserModel.GetPayToken()
```
- GetAccType：获取acctype
```
UserModel.GetAccType()
```
- RefreshUserTokens：刷新accessToken
```
UserModel.RefreshUserTokens()
```

